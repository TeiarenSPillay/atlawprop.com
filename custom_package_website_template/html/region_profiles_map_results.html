{% extends "eos_region_profiles_map_results.html" %}

{% block js %}

{% load humanize %}
{% load property_cart %}
{% load new_development_helpers %}

<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key={{ gmaps_key }}" type="text/javascript"></script> 
<script type="text/javascript">

var bounds = new GLatLngBounds();
function initialize() {
    if (GBrowserIsCompatible()) {
        function createMarker(point, icon, listing_id, image, heading, description, details) {
            var marker = new GMarker(point, { icon: icon });
            
            var html  = '<div class="column span-37 last"><div class="column"><img src="/resize/104/90/'+ image + '"></div>';
            html += '<div class="column last span-6"><div class="column span-6 last"><h3 class="margin-bottom0">'+ heading +'</h3>'+ description +'<br/>';
            html += '<div class="column"><a href="'+ details +'" class="more-info2">More info</a></div></div></div>'; 
            //, Directions, Zoom</div>';

            GEvent.addListener(marker, "click", function() {
                marker.openInfoWindowHtml(html);
            });
            
            // If a Listing ID is parsed and it matches this Listing Marker's ID
            // then open InfoWindow onload.
            if (listing_id == '{{ request.GET.id }}') {
                marker.openInfoWindowHtml(html);
            }
            
            return marker;
        }

        var map = new GMap2(document.getElementById("map_canvas"));
        map.setMapType(G_HYBRID_MAP);
        map.addControl(new GSmallMapControl());
        map.addControl(new GMapTypeControl());
        map.setCenter(new GLatLng(-28.793979, 24.763184), 6);

        // Create our icons
        var normalIcon = new GIcon();
        normalIcon.image = "/eos/img/area-profiles/summary/area-icon.png";
        normalIcon.iconSize = new GSize(29, 31);
        normalIcon.iconAnchor = new GPoint(20, 20);
        normalIcon.infoWindowAnchor = new GPoint(0, 0);

        {% for obj in obj_list %}
            {% if obj.map_x_position and obj.map_y_position %}
                var point = new GLatLng({{ obj.map_x_position }}, {{ obj.map_y_position }});

                var icon = normalIcon;
                var marker = createMarker(point, icon, '{{ obj.id }}','{{ obj.imagegallery_set.values.0.image }}', '{{ obj.location.region }}', '{{ obj.region_description|safe|truncatewords:"10" }}', '{{ obj.get_absolute_url }}');
                map.addOverlay(marker);
                bounds.extend(marker.getPoint());
            {% endif %}
        {% endfor %}
    
        // Set Zoom & Center on Bounds set by markers    
        map.setZoom(map.getBoundsZoomLevel(bounds));
        map.setCenter(bounds.getCenter());
    }
}
</script>
{% endblock js %}

{% block content %}
    <div class="column span-22 print-hide last">
        <p class="last font-size11 print-hide"><span class="breadcrumbs-dark">You are here:</span> <span class="breadcrumbs-light"><a href="/" class="other">{{ site_name }}</a> / <a href="/area-profiles/" class="other">Area Profiles</a> / Map</span>
        <div id="map-breadcrumbs-heading"><h1 class="last">Map</h1></div>
    </div>

    {% include 'includes/eos_region_profiles_main_navigation.html' %}

    <div class="column font-size11 span-22 border-bottom1 print-hide last">
        <div class="column"><img src="/eos/img/area-profiles/summary/area-icon.png" /></div>
        {% include 'includes/eos_region_profiles_map_navigation.html' %}
    </div>
    <div id="map_canvas">
        <span id="maploading">Loading Map</span>
    </div>
    <div class="column font-size11 border-top1 span-22 print-hide last"></div>
    <div class="column margin-top10 last print-hide span-22">
        <p class="font-size11 breadcrumbs-light"><b>Disclaimer:</b> While every effort will be made to ensure that the information contained within the {{ site_name }} website is accurate and up to date, {{ site_name }} makes no warranty, representation or undertaking whether expressed or implied, nor do we assume any legal liability, whether direct or indirect, or responsibility for the accuracy, completeness, or usefulness of any information. Prospective purchasers and tenants should make their own enquiries to verify the information contained herein.</p>
    </div>
{% endblock content %}